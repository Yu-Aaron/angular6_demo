<div class="detail">
  <div class="strategy" nz-row>
    <div nz-col nzSpan="8">
      <span class="strategy-key">ID：</span>
      <span class="strategy-value">{{auditPolicy.auditPolicyId}}</span>
    </div>
    <div nz-col nzSpan="6">
      <span class="strategy-key">策略名称：</span>
      <span class="strategy-value">{{auditPolicy.name}}</span>
    </div>
    <div nz-col nzSpan="4">
      <span class="strategy-key">创建时间：</span>
      <span class="strategy-value">{{auditPolicy.createdAt | date: 'yyyy-MM-dd HH:mm:ss'}}</span>
    </div>
    <div class="operate">
      <i class="edit" nz-icon nzType="edit" nzTheme="outline"></i>
      <i class="delete" nz-icon nzType="delete" nzTheme="outline"></i>
    </div>
  </div>
  <div class="tab">
    <nz-tabset>
      <nz-tab [nzTitle]="'威胁特征列表'" (nzSelect)="getTableData('SIGNATURE', signature)">
        <nz-table #signatureTable
                  [nzData]="signature.data"
                  [nzTotal]="signature.total"
                  [nzLoading]="signature.loading"
                  [nzShowTotal]="signatureTableTpl"
                  [nzShowQuickJumper]="true"
                  [nzFrontPagination]="false"
                  [nzPageIndex]="signature.pageIndex"
                  [nzPageSize]="signature.pageSize"
                  (nzPageIndexChange)="signatureTablePageChange($event)">
          <thead>
            <tr>
              <th>威胁名称</th>
              <th>服务类型分类</th>
              <th>漏洞类型</th>
              <th>危害等级</th>
              <th>基本描述</th>
              <th>特征项列表个数</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of signatureTable.data">
              <td>{{data.name}}</td>
              <td>{{data._serviceType}}</td>
              <td>{{data._category}}</td>
              <td>{{data._severity}}</td>
              <td>{{data._description}}</td>
              <td *ngIf="data.signatures">{{data.signatures.length}}</td>
              <td class="operate" (click)="getSignatureDetail(data)">
                <i class="search" nz-icon nzType="search" nzTheme="outline"></i>
              </td>
            </tr>
          </tbody>
        </nz-table>
        <ng-template #signatureTableTpl>
          <span>共 {{signature.total}} 条，</span>
          <span>每页展示 {{signature.pageSize}} 条，</span>
          <span>共 {{signature.pages}} 页</span>
        </ng-template>
      </nz-tab>
      <nz-tab [nzTitle]="'协议规则列表'" (nzSelect)="getTableData('PROTOCOL_RULE', protocol)">
        <nz-table #protocolTable
                  [nzData]="protocol.data"
                  [nzTotal]="protocol.total"
                  [nzLoading]="protocol.loading"
                  [nzShowTotal]="protocolTableTpl"
                  [nzShowQuickJumper]="true"
                  [nzFrontPagination]="false"
                  [nzPageIndex]="protocol.pageIndex"
                  [nzPageSize]="protocol.pageSize"
                  (nzPageIndexChange)="protocolTablePageChange($event)">
          <thead>
            <tr>
              <th>规则名称</th>
              <th>来源</th>
              <th>协议类型</th>
              <th>优先级</th>
              <th>规则描述</th>
              <th>是否告警</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of protocolTable.data">
              <td>{{data.name}}</td>
              <td>{{data.port}}</td>
              <td>{{data.strategy}}</td>
              <td>{{data.time}}</td>
              <td></td>
              <td></td>
              <td class="operate">
                <i class="search" nz-icon nzType="search" nzTheme="outline"></i>
              </td>
            </tr>
          </tbody>
        </nz-table>
        <ng-template #protocolTableTpl>
          <span>共 {{protocol.total}} 条，</span>
          <span>每页展示 {{protocol.pageSize}} 条，</span>
          <span>共 {{protocol.pages}} 页</span>
        </ng-template> 
      </nz-tab>
      <nz-tab [nzTitle]="'IP/MAC规则列表'" (nzSelect)="getTableData('IPMAC', ipmac)">
        <nz-table #ipmacTable
                  [nzData]="ipmac.data"
                  [nzTotal]="ipmac.total"
                  [nzLoading]="ipmac.loading"
                  [nzShowTotal]="ipmacTableTpl"
                  [nzShowQuickJumper]="true"
                  [nzFrontPagination]="false"
                  [nzPageIndex]="ipmac.pageIndex"
                  [nzPageSize]="ipmac.pageSize"
                  (nzPageIndexChange)="ipmacTablePageChange($event)">
          <thead>
            <tr>
              <th>工控设备名称</th>
              <th>IP</th>
              <th>MAC</th>
              <th>优先级</th>
              <th>策略引用次数</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of ipmacTable.data">
              <td>{{data.name}}</td>
              <td>{{data.port}}</td>
              <td>{{data.strategy}}</td>
              <td>{{data.time}}</td>
              <td></td>
            </tr>
          </tbody>
        </nz-table>
        <ng-template #ipmacTableTpl>
          <span>共 {{ipmac.total}} 条，</span>
          <span>每页展示 {{ipmac.pageSize}} 条，</span>
          <span>共 {{ipmac.pages}} 页</span>
        </ng-template> 
      </nz-tab>
      <nz-tab [nzTitle]="'域名规则列表'" (nzSelect)="getTableData('MALICIOUS_DOMAIN', domainName)">
        <nz-table #domainNameTable
                  [nzData]="domainName.data"
                  [nzTotal]="domainName.total"
                  [nzLoading]="domainName.loading"
                  [nzShowTotal]="domainNameTableTpl"
                  [nzShowQuickJumper]="true"
                  [nzFrontPagination]="false"
                  [nzPageIndex]="domainName.pageIndex"
                  [nzPageSize]="domainName.pageSize"
                  (nzPageIndexChange)="domainNameTablePageChange($event)">
          <thead>
            <tr>
              <th>域名</th>
              <th>来源</th>
              <th>创建时间</th>
              <th>策略引用次数</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of domainNameTable.data">
              <td>{{data.name}}</td>
              <td>{{data.port}}</td>
              <td>{{data.strategy}}</td>
              <td>{{data.time}}</td>
            </tr>
          </tbody>
        </nz-table>
        <ng-template #domainNameTableTpl>
          <span>共 {{domainName.total}} 条，</span>
          <span>每页展示 {{domainName.pageSize}} 条，</span>
          <span>共 {{domainName.pages}} 页</span>
        </ng-template> 
      </nz-tab>
    </nz-tabset>
  </div>
</div>
<nz-modal [(nzVisible)]="signatureDetail.modalFlag"
          nzWidth="1100"
          nzTitle="威胁详情"
          (nzOnCancel)="signatureDetail.modalFlag = false;"
          (nzOnOk)="signatureDetail.modalFlag = false;">
  <div class="details">
    <div class="info">
      <div nz-row>
        <div nz-col nzSpan="4">漏洞名称：</div>
        <div nz-col nzSpan="20">{{signatureDetail.policyBlocks.name}}</div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="4">服务类型分类：</div>
        <div nz-col nzSpan="20">{{signatureDetail.policyBlocks._serviceType}}</div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="4">漏洞类型：</div>
        <div nz-col nzSpan="20">{{signatureDetail.policyBlocks._category}}</div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="4">漏洞统一编号：</div>
        <div nz-col nzSpan="20" *ngIf="signatureDetail.policyBlocks._cve">{{signatureDetail.policyBlocks._cve}}</div>
        <div nz-col nzSpan="20" *ngIf="!signatureDetail.policyBlocks._cve">无</div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="4">危害等级：</div>
        <div nz-col nzSpan="20">{{signatureDetail.policyBlocks._severity}}</div>
      </div>
      <div nz-row>
        <div nz-col nzSpan="4">基本描述</div>
        <div nz-col nzSpan="20">{{signatureDetail.policyBlocks._description}}</div>
      </div>
    </div>
    <nz-table #signatureItemTable 
              [nzData]="signatureDetail.policyBlocks.signatures"
              [nzShowPagination]="false">
      <thead>
        <tr>
          <th>优先级</th>
          <th>特征名称</th>
          <th>风险等级</th>
          <th>特征编号</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of signatureItemTable.data">
          <td>{{$index+1}}</td>
          <td>{{item.signame}}</td>
          <td>{{item.riskLevel | riskLevel}}</td>
          <td>{{item.sid}}</td>
        </tr>
      </tbody>
    </nz-table>
  </div>
</nz-modal>