<div class="security_incident_content">
  <div class="content_filter">
    <!-- 过滤条件 -->
    <app-filter-table *ngIf="filterFlag"
                      [timeValueData]="filterConditionData.timeValueData"
                      [controlArray]="filterConditionData.controlArray"
                      [showTimePicker]="true"
                      [filterFlag]="filterFlag"
                      (filterTable)="filterButton($event)"
                      (searchFilterTable)="searchFilterTable($event)"></app-filter-table>
    <div class="float_left">
      <button nz-button nzType="primary" class="margin-right-40" (click)="searchData()">刷新</button>
      <nz-dropdown [nzTrigger]="'click'">
        <button nz-button nz-dropdown nzType="primary">更多操作<i nz-icon type="down"></i></button>
        <ul nz-menu>
          <li nz-menu-item *ngFor="let item of items" (click)="filterModalData(item.value)" [nzSelected]="item.select" [nzDisabled]="item.disabled">
            <a>{{item.label}}</a>
          </li>
        </ul>
      </nz-dropdown>
    </div>
    <div class="float_right content_filter_right" nzCompact>
        <form [formGroup]="formModel" novalidate>
            <i nz-icon type="search" *ngIf="!filterFlag"></i>
            <nz-input-group nzSearch [nzSuffix]="suffixButton" style="width: 63%;" *ngIf="!filterFlag" nzSize="large">
              <input type="text" nz-input placeholder="input search text" formControlName="query">
            </nz-input-group>
            <ng-template #suffixButton>
              <button nz-button nzType="primary" nzSearch nzSize="large" (click)="searchData()">搜索</button>
            </ng-template>
            <button nz-button nzType="primary" style="width: 25%"  class="margin-left-40" (click)="filterFlag = !filterFlag;" *ngIf="!filterFlag">过滤条件</button>
        </form>
    </div>
  </div>
  <div class="content_table">
    <nz-table
      #basicTable
      nzBordered
      [nzData]="dataSet"
      [nzShowQuickJumper]="true"
      [nzTotal]="tableTotalData"
      [nzFrontPagination]="false"
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      (nzPageIndexChange)="pageIndexChange()"
      (nzPageSizeChange)="searchData(true)"
      [nzLoading]="loading"
      [nzShowTotal]="totalTemplate"
      [nzNoResult]="'没有数据'"
      >
      <thead (nzSortChange)="sort($event)" nzSingleSort>
        <tr>
          <th>状态(已读/未读)</th>
          <th>处理方式</th>
          <th>风险等级</th>
          <th nzShowSort nzSortKey="timestamp">日期</th>
          <th>起源</th>
          <th>保护终端</th>
          <th>目标</th>
          <th>协议</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let data of basicTable.data">
          <td>
              <span class="status ng-hide" *ngIf="data.status == 'NEW'">未读</span>
              <span *ngIf="data.status != 'NEW'">已读</span>
          </td>
          <td>
              {{data.level | eventLevel}}
          </td>
          <td>{{data.riskLevel | eventRiskLevel}}</td>
          <td>{{data.timestamp | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
          <td>{{data.sourceName}}</td>
          <td>{{data.deviceName}}</td>
          <td>{{data.destinationName}}</td>
          <td>{{data.appLayerProtocol}}</td>
          <td>
              <a class="btn_checkDetails" [routerLink]="['/pages/security/secincident', data.incidentId]">查看</a>
          </td>
        </tr>
      </tbody>
    </nz-table>
    <ng-template #totalTemplate let-total>
        <span>共 {{tableTotalData}} 个事件，</span>
        <span>每页展示{{pageSize}}个事件，</span>
        <span>共{{pageTotalNumber}}页</span>
    </ng-template>
  </div>
  <!-- 模态弹框 -->
  <nz-modal [(nzVisible)]="isVisible" [nzTitle]="modalTitle" [nzFooter]="modalFooter" (nzOnCancel)="handleCancel()" (nzOnOk)="handleOk()">
    <p>{{modalContent}}</p>
    <ng-template #modalFooter>
      <button nz-button nzType="default" (click)="handleCancel()" class="float_left">取消</button>
      <button nz-button nzType="primary" (click)="handleOk()">确定</button>
    </ng-template>
  </nz-modal>
  <app-modal [isVisible]="exportIsVisible" (exportVisibleTriggle)="exportVisibleTriggle($event)" [exportTypeFlag]="exportTypeFlag" [exportParams]="exportParams"></app-modal>
</div>

